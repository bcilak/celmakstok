{% extends "base.html" %}

{% block title %}Excel'den Toplu ÃœrÃ¼n Aktarma{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-md-12">
            <h2>ğŸ“Š Excel'den Toplu ÃœrÃ¼n Aktarma</h2>
            <p class="text-muted">Excel dosyasÄ±ndan Ã¼rÃ¼nleri yÃ¼kleyin, kategorilerini web Ã¼zerinden seÃ§in ve kaydedin.</p>
        </div>
    </div>

    <!-- AdÄ±mlar -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">ğŸ“‹ NasÄ±l KullanÄ±lÄ±r?</h5>
            <div class="row">
                <div class="col-md-4">
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-primary rounded-circle me-2" style="width: 30px; height: 30px; line-height: 30px;">1</span>
                        <strong>Åablonu Ä°ndirin</strong>
                    </div>
                    <p class="text-muted ms-4">Excel ÅŸablonunu indirip doldurun</p>
                </div>
                <div class="col-md-4">
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-primary rounded-circle me-2" style="width: 30px; height: 30px; line-height: 30px;">2</span>
                        <strong>DosyayÄ± YÃ¼kleyin</strong>
                    </div>
                    <p class="text-muted ms-4">DoldurduÄŸunuz Excel'i yÃ¼kleyin</p>
                </div>
                <div class="col-md-4">
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-primary rounded-circle me-2" style="width: 30px; height: 30px; line-height: 30px;">3</span>
                        <strong>Kategorileri SeÃ§in</strong>
                    </div>
                    <p class="text-muted ms-4">Web'de kategori seÃ§ip kaydedin</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Åablon Ä°ndirme -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">1ï¸âƒ£ Excel Åablonunu Ä°ndirin</h5>
            <p class="mb-3">BasitleÅŸtirilmiÅŸ ÅŸablon - Kategori ID'ye gerek yok, sonraki adÄ±mda web Ã¼zerinden seÃ§eceksiniz.</p>
            <a href="{{ url_for('products.download_simple_template') }}" class="btn btn-success">
                <i class="bi bi-download"></i> Åablon Ä°ndir
            </a>
            <div class="alert alert-info mt-3 mb-0">
                <i class="bi bi-info-circle"></i>
                <strong>Åablon Ä°Ã§eriÄŸi:</strong> ÃœrÃ¼n Kodu, ÃœrÃ¼n AdÄ±, Birim Tipi, Stok Bilgileri, Barkod, Notlar
                <br>
                <small class="text-muted">Kategori bilgisi ÅŸablonda YOK - bir sonraki adÄ±mda web Ã¼zerinden seÃ§eceksiniz!</small>
            </div>
        </div>
    </div>

    <!-- Dosya YÃ¼kleme -->
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">2ï¸âƒ£ Excel DosyasÄ±nÄ± YÃ¼kleyin</h5>
            <form method="POST" action="{{ url_for('products.simple_upload_import') }}" enctype="multipart/form-data" id="uploadForm">
                <div class="mb-3">
                    <label for="file" class="form-label">Excel DosyasÄ± (.xlsx veya .xls)</label>
                    <input type="file" class="form-control" id="file" name="file" accept=".xlsx,.xls" required>
                    <div class="form-text">
                        Maksimum dosya boyutu: 10MB
                    </div>
                </div>

                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle"></i>
                    <strong>Dikkat:</strong>
                    <ul class="mb-0 mt-2">
                        <li>ÃœrÃ¼n Kodu ve ÃœrÃ¼n AdÄ± <strong>zorunludur</strong></li>
                        <li>Kategorileri bir sonraki adÄ±mda web Ã¼zerinden seÃ§eceksiniz</li>
                        <li>Mevcut Ã¼rÃ¼n kodlarÄ± gÃ¼ncellenir, yenileri eklenir</li>
                        <li>Åablon formatÄ±na uygun dosya yÃ¼kleyin</li>
                    </ul>
                </div>

                <button type="submit" class="btn btn-primary" id="uploadBtn">
                    <i class="bi bi-upload"></i> YÃ¼kle ve Ã–nizle
                </button>
                <a href="{{ url_for('products.index') }}" class="btn btn-secondary">
                    <i class="bi bi-x-circle"></i> Ä°ptal
                </a>
            </form>
        </div>
    </div>

    <!-- YardÄ±m KartÄ± -->
    <div class="card mt-4">
        <div class="card-body">
            <h5 class="card-title">ğŸ’¡ Ä°puÃ§larÄ±</h5>
            <div class="row">
                <div class="col-md-6">
                    <h6>Excel'i Doldururken:</h6>
                    <ul>
                        <li>Her Ã¼rÃ¼n iÃ§in <strong>ÃœrÃ¼n Kodu</strong> ve <strong>ÃœrÃ¼n AdÄ±</strong> mutlaka doldurun</li>
                        <li>Birim Tipi: adet, kg, metre, litre, m2, m3</li>
                        <li>Stok deÄŸerleri sayÄ± olmalÄ± (0 da olabilir)</li>
                        <li>Barkod varsa metin olarak girin (baÅŸÄ±na ' koyun)</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>Sonraki AdÄ±mda:</h6>
                    <ul>
                        <li>TÃ¼m Ã¼rÃ¼nlerinizi Ã¶nizleyeceksiniz</li>
                        <li>Her Ã¼rÃ¼n iÃ§in <strong>kategori dropdown'dan seÃ§ilecek</strong></li>
                        <li>GÃ¼ncellenen ve yeni eklenen Ã¼rÃ¼nler iÅŸaretlenecek</li>
                        <li>OnayladÄ±ktan sonra veritabanÄ±na kaydedilecek</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('uploadForm').addEventListener('submit', function(e) {
    const fileInput = document.getElementById('file');
    const uploadBtn = document.getElementById('uploadBtn');

    if (!fileInput.files || fileInput.files.length === 0) {
        e.preventDefault();
        alert('LÃ¼tfen bir Excel dosyasÄ± seÃ§in.');
        return false;
    }

    const file = fileInput.files[0];
    const fileSize = file.size / 1024 / 1024; // MB

    if (fileSize > 10) {
        e.preventDefault();
        alert('Dosya boyutu 10MB\'dan bÃ¼yÃ¼k olamaz.');
        return false;
    }

    const fileName = file.name.toLowerCase();
    if (!fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
        e.preventDefault();
        alert('Sadece Excel dosyalarÄ± (.xlsx veya .xls) yÃ¼kleyebilirsiniz.');
        return false;
    }

    // Show loading
    uploadBtn.disabled = true;
    uploadBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> YÃ¼kleniyor...';
});
</script>
{% endblock %}
